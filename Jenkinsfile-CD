pipeline {
    agent any

    parameters {
        string(name: 'IMAGE_TAG', defaultValue: 'latest', description: 'Docker image tag to deploy')
    }

    environment {
        IMAGE_NAME = 'asif1993/second_ml'
    }

    stages {
        stage('Checkout') {
            steps { 
                git branch: 'main', credentialsId: 'git-cred', url: 'https://github.com/AsifShaikh93/first_ml.git' 
            }
        }
    
        stage('Check for [ci skip]') {
    steps {
        script {
            def msg = sh(
                script: "git log -1 --pretty=%B",
                returnStdout: true
            ).trim()

            if (msg.contains('[ci skip]')) {
                echo "Commit message contains [ci skip] â€“ skipping CI pipeline."

                // Mark as NOT_BUILT (or ABORTED if you prefer)
                currentBuild.result = 'NOT_BUILT'

                // This actually STOPS the pipeline right here
                error("CI skipped due to [ci skip] in commit message")
            }
        }
    }
}

    }
}
